2025年3月27日
13点50分
记录实验数据 

固定：物理分割好训练集和测试集


| 文件    | 数据集      | model               | 超参数             | acc  | auc  | 指标                                                   |     |
| ----- | -------- | ------------------- | --------------- | ---- | ---- | ---------------------------------------------------- | --- |
| copy  | 非固定      | resnet+vit<br>交叉注意力 | batch_size = 48 | 0.93 | 0.95 | benign 0.95 0.94 0.95 88 malignant 0.88 0.90 0.89 42 |     |
| copy2 | 固定       | resnet+vit<br>交叉注意力 | batch_size = 36 | 0.92 | 0.96 | benign 0.95 0.92 0.94 88 malignant 0.84 0.90 0.87 42 |     |
| train | 固定 + 模块化 | resnet+vit<br>交叉注意力 | batch_size = 36 | 0.88 | 0.94 | benign 0.94 0.89 0.91 88 malignant 0.79 0.88 0.83 42 |     |
|       |          |                     |                 |      |      |                                                      |     |

复现不了 很伤心
16点25分


超参数
```PYTHON
class Config:
    batch_size = 32
    num_epochs = 100
    lr = 1e-4
    weight_decay = 0.01
    early_stop_patience = 5
    trad_feat_dim = 93  # 根据实际特征维度修改
    num_workers = 8  # 多线程加载数据
```

| confuse          | ACC  | AUC  | 指标                                                   |
| ---------------- | ---- | ---- | ---------------------------------------------------- |
| [[83 5] [ 3 39]] | 0.94 | 0.95 | benign 0.97 0.94 0.95 88 malignant 0.89 0.93 0.91 42 |


#### 模型 radio+cnn+vit
```python
optimizer = optim.Adam(model.parameters(),  lr=Config.lr,weight_decay=Config.weight_decay)
scheduler = optim.lr_scheduler.StepLR(optimizer, step_size=4, gamma=0.1)
criterion = nn.CrossEntropyLoss()
```


|     | 特征融合部分 | B_size |  LR  |    Features    |      confuse      |     ACC     |    AUC     |           指标           |            |
| :-: | :----: | :----: | :--: | :------------: | :---------------: | :---------: | :--------: | :--------------------: | :--------: |
|     |        |   16   | 1e-4 | first_order 93 | [[79 9] [ 4 38]]  |    0.90     |    0.94    | step_size=4, gamma=0.1 |            |
|     |        |   16   | 3e-4 |  first_order   | [[79 9] [11 31]]  |    0.85     |    0.89    | step_size=4, gamma=0.1 |            |
|     |        |   32   | 1e-4 |  first_order   | [[78 10] [ 3 39]] |    0.90     |    0.95    | step_size=4, gamma=0.1 |            |
|     |        |   32   | 1e-4 |  first_order   | [[80 8] [ 4 38]]  |    0.91     |    0.95    | step_size=4, gamma=0.5 |            |
|     |        |   32   | 3e-4 |  first_order   | [[79 9] [ 5 37]]  |    0.89     |    0.95    | step_size=4, gamma=0.1 |            |
|     |        |   32   | 3e-4 |  first_order   | [[83 5] [ 7 35]]  | ***0.91***  | ***0.96*** | step_size=3, gamma=0.5 |            |
|     |        |   32   | 3e-4 |  first_order   | [[82 6] [ 4 38]]  |    0.92     |    0.95    | step_size=4, gamma=0.5 |            |
|     |   最优   |   32   | 1e-4 | first_order 93 | [[80 8] [ 3 39]]  |    0.92     |    0.96    | step_size=5, gamma=0.4 | early_st10 |
|     |   最优   |   32   | 1e-4 |      436       | [[83 5] [ 5 37]]  |    0.92     |    0.96    | step_size=5, gamma=0.4 | early_st10 |
| c3  | 1*/1卷积 |   32   | 1e-4 |      436       | [[77 11] [ 4 38]] | 0.88（0.92）  |    0.96    | step_size=5, gamma=0.4 | early_st10 |
|     |        |   32   | 1e-4 |       93       | [[80 8] [ 4 38]]  | 0.91（0.93）  | 0.94（0.96） | step_size=5, gamma=0.4 | early_st10 |
| c4  | 交叉注意力  |   32   | 1e-4 |       93       | [[81 7] [ 3 39]]  | 0.92 （0.91） | 0.96（0.94） | step_size=5, gamma=0.4 | early_st10 |
|     |        |   32   | 1e-4 |      469       | [[76 12] [ 4 38]] |    0.88     |    0.94    |                        |            |

#### 模型 radio+cnn+vit + 对比学习
```python
class Config: 

    base_dir = "/home/zhengsongming/jupyterworkspace/datasets/BUSI_Clean/"  # 数据集根目录

    npy_dir = "/home/zhengsongming/jupyterworkspace/datasets/BUSI_first_order_features_npy"  # 特征文件目录

    batch_size = 32

    num_epochs = 100

    lr = 1e-4

    weight_decay = 0.01

    early_stop_patience = 10

    device = torch.device("cuda:1" if torch.cuda.is_available() else "cpu")

    model_save_path = "./best_model_hybrid.pth"

    trad_feat_dim = 93  # 根据实际特征维度修改

    num_workers = 8  # 多线程加载数据
   # 初始化模型

        model = model_class().to(Config.device)

        # ================= 关键修改3：优化器配置 =================

        optimizer = optim.AdamW(model.parameters(),

                              lr=Config.lr,

                              weight_decay=Config.weight_decay)

        # ================= 关键修改4：双损失函数 =================

        criterion_cls = nn.CrossEntropyLoss()

        criterion_contrast = DualContrast(temp=0.07)  # 新增对比损失

        # ================= 关键修改5：学习率调度器 =================

        # scheduler = optim.lr_scheduler.CosineAnnealingLR(optimizer,

        #                                                T_max=Config.num_epochs)

        scheduler = optim.lr_scheduler.StepLR(optimizer, step_size=5, gamma=0.4)
```

| 特征集 | ACC           | AUC           | matrix           |     |     |
| --- | ------------- | ------------- | ---------------- | --- | --- |
|     | 0.9077        | 0.9524        | [[82 6] [ 6 36]] |     |     |
| 934 | 0.9077 0.9308 | 0.9407 0.9535 | [[81 7] [ 5 37]] |     |     |
| 463 | 0.8923 0.9077 | 0.9581 0.9665 | [[80 8] [ 3 39]] |     |     |
| 93  | 0.9154 0.9077 | 0.9532 0.9521 |                  |     |     |

改模型结构
在c1的基础上修改最后的两个融合分支融合结构
step = 3 gamm=0.7

|       | 特征集个数 | ACC           | AUC           | matrix            | 单分支融合 |     |
| ----- | ----- | ------------- | ------------- | ----------------- | ----- | --- |
| cat   | 934   | 0.8846 0.8769 | 0.9343 0.9462 | [[79 9] [ 6 36]]  |       |     |
| 自注意力  | 934   | 0.9000 0.8846 | 0.9551 0.9481 | [[82 6] [ 7 35]]  |       |     |
| 交叉注意力 | 934   | 0.9077 0.9000 | 0.9491 0.9472 |                   |       |     |
| cat   | 93    | 0.8615 0.8923 | 0.9440 0.9527 | [[77 11] [ 7 35]] |       |     |
| 自注意力  | 93    | 0.8692 0.8923 | 0.9188 0.9196 | [[80 8] [ 6 36]]  |       |     |
| 交叉注意力 | 93    | 0.9077 0.9000 | 0.9462 0.9502 | [[81 7] [ 5 37]]  |       |     |
| cat   | 469   | 0.8923 0.8923 | 0.9486 0.9521 | [[82 6] [ 8 34]]  |       |     |
|       |       | 0.9077 0.8923 | 0.9518 0.9399 | [[81 7] [ 5 37]]  | 加上残差  |     |
| 自注意力  | 469   | 0.9000 0.9000 | 0.9502 0.9543 | [[80 8] [ 5 37]]  |       |     |
|       |       | 0.8923 0.8769 | 0.9462 0.9551 | [[81 7] [ 5 37]]  | 加上残差  |     |
| 交叉注意力 | 469   | 0.8462 0.8615 | 0.9259 0.9267 | [[76 12] [ 8 34]] |       |     |
|       |       | 0.8923 0.9077 | 0.9545 0.9527 | [[81 7] [ 5 37]]  | 加上残差  |     |
|       |       |               |               |                   |       |     |
